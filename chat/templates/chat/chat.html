<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shree Chatbot</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .chat-box {
            height: 70vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .msg {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 12px;
            margin-bottom: 10px;
            line-height: 1.4rem;
        }
    </style>
</head>

<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

<div class="w-full max-w-lg p-6 bg-gray-800 rounded-xl shadow-xl">

    <h2 class="text-2xl font-bold text-center mb-4">ðŸ’¬ A-Shree Chatbot</h2>

    <!-- Chat Area -->
    <div id="chatBox" class="chat-box bg-gray-700 p-4 rounded-lg mb-4">
        <div class="msg bg-gray-600">ðŸ‘‹ Hello! I'm Shree, How can I help you?</div>
    </div>

    <!-- Input Row -->
    <div class="flex space-x-2">
        <input id="userInput" 
               type="text" 
               class="w-full p-3 rounded-lg bg-gray-600 outline-none"
               placeholder="Type your message...">

        <button onclick="sendMessage()"
                class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
            Send
        </button>
    </div>

</div>

<script>
let conversation_id = null;
async function sendMessage() {
    const input = document.getElementById("userInput");
    const chatBox = document.getElementById("chatBox");

    const userText = input.value.trim();
    if (!userText) return;

    // Add user message
    chatBox.innerHTML += `
        <div class="msg bg-blue-600 ml-auto">${userText}</div>
    `;
    input.value = "";
    chatBox.scrollTop = chatBox.scrollHeight;

    // Send to Django API endpoint
    const response = await fetch("/api/chat/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userText,conversation_id:conversation_id })
    });

    const data = await response.json();
    conversation_id= data.conversation_id
    // Add bot message
    chatBox.innerHTML += `
        <div class="msg bg-gray-600">${data.reply}</div>
    `;
    chatBox.scrollTop = chatBox.scrollHeight;
}
</script>

</body>
</html>
